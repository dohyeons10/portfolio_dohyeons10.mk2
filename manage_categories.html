<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="firebase_config.js"></script>
    <script src="admin_key.js"></script>
    <script src="auth.js"></script>
    <title>말머리 관리</title>
</head>
<body>
    <a href="manage_blog.html" class="back-button">이전으로</a>
    <div class="container">
        <h1>말머리 관리</h1>
        <p>게시글의 말머리(카테고리)를 추가하거나 삭제할 수 있습니다.</p>

        <div style="margin-bottom: 20px; display: flex; gap: 10px; justify-content: center;">
            <input type="text" id="new-category" placeholder="새 말머리 이름" style="padding: 10px; width: 60%;">
            <button onclick="addCategory()" class="write-button" style="margin: 0;">추가</button>
        </div>

        <ul id="category-list" class="comments-list">
            <!-- 자바스크립트로 목록이 추가됩니다 -->
        </ul>
        
        <button onclick="resetCategories()" style="background-color: #6c757d; color: white; border: none; padding: 10px; border-radius: 4px; margin-top: 20px; cursor: pointer;">기본값으로 초기화</button>
    </div>

    <script>
        // 관리자 권한 확인
        if (sessionStorage.getItem('isAdmin') !== 'true') {
            alert('관리자만 접근할 수 있습니다.');
            window.location.href = 'blog.html';
        }

        const defaultCategories = ['정보', '일상', '잡담', '질문', '후기', '체험단'];
        let categories = [];
        
        // Firebase에서 불러오기
        db.ref('post_categories').on('value', (snapshot) => {
            categories = snapshot.val() || defaultCategories;
            renderCategories();
        });

        const list = document.getElementById('category-list');

        function renderCategories() {
            list.innerHTML = '';
            categories.forEach((cat, index) => {
                const li = document.createElement('li');
                li.className = 'comment-item';
                li.style.display = 'flex';
                li.style.justifyContent = 'space-between';
                li.style.alignItems = 'center';
                li.innerHTML = `
                    <span>${cat}</span>
                    <button onclick="deleteCategory(${index})" class="delete-button" style="margin: 0;">삭제</button>
                `;
                list.appendChild(li);
            });
        }

        function addCategory() {
            const input = document.getElementById('new-category');
            const val = input.value.trim();
            if (val) {
                if (categories.includes(val)) {
                    alert('이미 존재하는 말머리입니다.');
                    return;
                }
                categories.push(val);
                save();
                input.value = '';
                renderCategories();
            } else {
                alert('말머리 이름을 입력해주세요.');
            }
        }

        function deleteCategory(index) {
            if (confirm('정말 삭제하시겠습니까?')) {
                categories.splice(index, 1);
                save();
                renderCategories();
            }
        }

        function resetCategories() {
            if (confirm('모든 설정을 초기화하고 기본 말머리로 되돌리시겠습니까?')) {
                categories = [...defaultCategories];
                save();
            }
        }

        function save() {
            db.ref('post_categories').set(categories);
        }
    </script>
</body>
</html>